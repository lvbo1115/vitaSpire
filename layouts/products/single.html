{{ define "main" }}
{{/* === 获取所属大类颜色 === */}}
{{ $path := "" }}
{{ with .File }}
  {{ $path = .Dir | strings.TrimSuffix "/" }}
{{ end }}
{{ $parts := split $path "/" }}
{{ $color := "gray" }}
{{ $colorMap := dict
  "biomedical-health-materials" "indigo"
  "human-nutrition-solutions" "emerald"
  "advanced-industrial-materials" "red"
}}
{{ if gt (len $parts) 1 }}
  {{ $parentSlug := index $parts 0 }}
  {{ if isset $colorMap $parentSlug }}
    {{ $color = index $colorMap $parentSlug }}
  {{ end }}
{{ end }}

{{/* === 定义所有可能的字段及其显示名称 === */}}
{{ $fieldMap := dict
  "cat" "Cat."
  "background" "Background"
  "product_description" "Product Description"
  "morphology_appearance" "Morphology & Appearance"
  "purity" "Purity"
  "thickness" "Thickness"
  "diameter" "Diameter"
  "layer" "Layer"
  "surface_area" "Surface Area"
  "particle_size" "Particle Size"
  "product_size" "Product Size"
  "manufacture_method" "Manufacture Method"
  "viscosity" "Viscosity"
  "molecular_weight" "Molecular Weight"
  "ph" "pH"
  "cas_number" "CAS Number"
  "components" "Components"
  "source" "Source"
  "solubility" "Solubility"
  "stability" "Stability"
  "storage" "Storage"
  "concentration" "Concentration"
  "shipping_packaging" "Shipping & Packaging"
  "application" "Application"
  "usage" "Usage"
  "warning" "Warning"
  "references" "References"
}}

<div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-12">
  <!-- Product Header -->
  <div class="text-center mb-10">
    <h1 class="hero-title text-4xl md:text-5xl font-bold mb-4">{{ .Title }}</h1>
    {{ with .Params.category }}
      <span class="inline-block bg-{{ $color }}-100 text-{{ $color }}-800 px-4 py-1 rounded-full text-sm font-medium mb-6">
        {{ . }}
      </span>
    {{ end }}
  </div>

  <!-- Product Image -->
  {{ with .Params.image }}
    <div class="mb-12 rounded-2xl overflow-hidden shadow-xl border border-gray-200/50">
      <img src="{{ . }}" alt="{{ $.Title }}" class="w-full h-auto">
    </div>
  {{ end }}

  <!-- Product Code -->
  {{ with .Params.cat }}
    <div class="text-center mb-10">
      <div class="inline-flex items-center bg-white/70 backdrop-blur-sm rounded-full px-6 py-3 shadow-lg border border-{{ $color }}-200">
        <i class="fas fa-barcode text-{{ $color }}-600 mr-3 text-xl"></i>
        <span class="text-{{ $color }}-700 font-mono font-bold text-lg">{{ . }}</span>
      </div>
    </div>
  {{ end }}

  <!-- Dynamic Sections -->
  <div class="bg-white/70 backdrop-blur-sm rounded-2xl p-8 shadow-lg">
    {{/* Render Background and Product Description as paragraphs */}}
    {{ with .Params.background }}
      <section class="mb-8">
        <h2 class="text-2xl font-bold text-gray-900 mb-4 pb-2 border-b border-gray-200">Background</h2>
        <div class="prose prose-lg max-w-none">{{ . | markdownify }}</div>
      </section>
    {{ end }}

    {{ with .Params.product_description }}
      <section class="mb-8">
        <h2 class="text-2xl font-bold text-gray-900 mb-4 pb-2 border-b border-gray-200">Product Description</h2>
        <div class="prose prose-lg max-w-none">{{ . | markdownify }}</div>
      </section>
    {{ end }}

    <!-- Technical Specifications Grid -->
    {{ $hasSpecs := false }}
    {{ range $key, $value := $.Params }}
      {{ if and (ne $key "title") (ne $key "description") (ne $key "image") (ne $key "category") (ne $key "cat") (ne $key "background") (ne $key "product_description") }}
        {{ $hasSpecs = true }}
      {{ end }}
    {{ end }}

    {{ if $hasSpecs }}
      <section>
        <h2 class="text-2xl font-bold text-gray-900 mb-6 pb-2 border-b border-gray-200">Technical Specifications</h2>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          {{ range $key, $value := $.Params }}
            {{ if and (ne $key "title") (ne $key "description") (ne $key "image") (ne $key "category") (ne $key "cat") (ne $key "background") (ne $key "product_description") }}
              {{ $label := index $fieldMap $key | default $key }}
              <div class="bg-gray-50/50 p-5 rounded-xl">
                <h3 class="font-semibold text-gray-700 mb-2">{{ $label }}</h3>
                <p class="text-gray-900">{{ $value }}</p>
              </div>
            {{ end }}
          {{ end }}
        </div>
      </section>
    {{ end }}
  </div>

  <!-- CTA Section -->
  <div class="mt-12 text-center">
    <div class="inline-block bg-gradient-to-r from-{{ $color }}-600 to-{{ 
      if eq $color "indigo" }}purple
      {{ else if eq $color "emerald" }}teal
      {{ else if eq $color "red" }}orange
      {{ else }}gray{{ end }}-600 
      text-white px-8 py-4 rounded-xl shadow-lg hover:shadow-xl transition-all duration-300">
      <a href="/contact/" class="flex items-center font-semibold no-underline text-white">
        Contact Us for Details
        <i class="fas fa-arrow-right ml-3 text-white"></i>
      </a>
    </div>
  </div>

  <!-- Back to Category -->
  <div class="mt-8 text-center">
    <a href="{{ .Parent.RelPermalink }}" class="inline-flex items-center text-indigo-600 hover:text-indigo-800 font-medium group">
      <i class="fas fa-arrow-left mr-2 group-hover:-translate-x-1 transition-transform"></i>
      Back to {{ .Parent.Title }}
    </a>
  </div>
</div>
{{ end }}